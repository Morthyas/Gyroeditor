
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Gyro Editor 2.0</title>
  <style>
    body { background:#111; color:#fff; text-align:center; font-family:Arial; }
    img { width:90%; max-width:600px; margin-top:20px; transition:filter 0.05s linear; }
    #info { margin-top:20px; font-size:1.2em; }
    #saveBtn { margin-top:20px; padding:10px 20px; font-size:1em; border:none; border-radius:8px; background:#28a745; color:#fff; }
    #saveBtn:hover { background:#218838; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Gyro Editor 2.0</h1>
  <p>Nakláněním měníš <span id="modeName">jas</span> – kliknutím přepínáš režimy.</p>
  <img id="photo" src="https://picsum.photos/800/500" alt="Obrázek">
  <div id="info">Jas: 100%</div>
  <button id="saveBtn">Save</button>

  <script>
    let brightness = 100, contrast = 100, saturate = 100, hue = 0;
    const img = document.getElementById("photo");
    const info = document.getElementById("info");
    const modeName = document.getElementById("modeName");
    const saveBtn = document.getElementById("saveBtn");
    let mode = 0; // 0=jas, 1=kontrast, 2=saturace, 3=metalický efekt, 4=odstín
    const modeLabels = ["jas", "kontrast", "saturaci", "metalický efekt", "odstín"];
    let tiltValues = [];

    function updateFilter() {
      let metallic = mode === 3 ? `hue-rotate(${hue}deg)` : "";
      let grayscale = mode === 4 ? `grayscale(${100 - brightness}%)` : "";
      img.style.filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturate}%) ${metallic} ${grayscale}`;
    }

    // Vyhlazení hodnot (citlivější + plynulejší)
    function smoothTilt(val) {
      tiltValues.push(val);
      if (tiltValues.length > 5) tiltValues.shift();
      return tiltValues.reduce((a,b) => a+b,0)/tiltValues.length;
    }

    window.addEventListener('deviceorientation', (event) => {
      let tilt = event.gamma;
      if (tilt !== null) {
        let smooth = smoothTilt(tilt);
        let value = Math.min(200, Math.max(0, 100 + (smooth * (200/60)))); // citlivější: +/-30° ~ 0-200%
        if (mode === 0) brightness = value;
        if (mode === 1) contrast = value;
        if (mode === 2) saturate = value;
        if (mode === 3) hue = (smooth * 3); // jemný barevný posun
        if (mode === 4) brightness = value; // využíváme brightness jako řízení grayscale
        updateFilter();
        info.textContent = `${modeLabels[mode][0].toUpperCase() + modeLabels[mode].slice(1)}: ${Math.round(value)}%`;
      }
    });

    img.addEventListener('click', () => {
      mode = (mode + 1) % 5;
      modeName.textContent = modeLabels[mode];
    });

    // Save aktuální obrázek jako PNG
    saveBtn.addEventListener('click', () => {
      html2canvas(img).then(canvas => {
        const link = document.createElement('a');
        link.download = 'upraveny_obrazek.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    });

    // Načtení knihovny html2canvas pro export
    const script = document.createElement('script');
    script.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
    document.head.appendChild(script);
  </script>
</body>
</html>
